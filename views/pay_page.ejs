<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="Kyla Olitoquit">
    <meta name="description" content="Payment Page">
    <link rel="icon" type="image/png" href="../public/img/favicon.png" />
    <title>Wheely</title>

    <!-- normalize.css for cross-browser stuff -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">

    <!-- include required fonts -->
    <!-- Montserrat -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap" rel="stylesheet">

    <!-- Link to my CSS -->
    <link rel="stylesheet" href="../public/paypage.css">
    <script>
        function validateForm() {
            const form = document.forms["paymentForm"];
            let valid = true;
            let errorMsg = "";

            // Regular expressions for validation
            const cardNumberRegex = /^\d{16}$/;
            const expirationDateRegex = /^(0[1-9]|1[0-2])\/\d{4}$/;
            const cvvRegex = /^\d{3}$/;
            const zipCodeRegex = /^\d{5}$/;

            // Card Information Validation
            if (form["name"].value.trim() === "") {
                errorMsg += "Name on card is required.\n";
                valid = false;
            }
            if (!cardNumberRegex.test(form["card-number"].value)) {
                errorMsg += "Card number must be 16 digits.\n";
                valid = false;
            }
            if (!expirationDateRegex.test(form["expiration-date"].value)) {
                errorMsg += "Expiration date must be in MM/YYYY format.\n";
                valid = false;
            }
            if (!cvvRegex.test(form["cvv"].value)) {
                errorMsg += "CVV must be 3 digits.\n";
                valid = false;
            }

            // Address Validation
            if (form["address"].value.trim() === "") {
                errorMsg += "Address is required.\n";
                valid = false;
            }
            if (!zipCodeRegex.test(form["zip-code"].value)) {
                errorMsg += "Zip code must be 5 digits.\n";
                valid = false;
            }

            if (!valid) {
                alert(errorMsg);
            }

            return valid;
        }
    </script>
</head>
<body>
    <!--Nav bar-->
    <nav class="top-nav">
        <li><a href="/"><img class="logo" src="../public/img/logo+name.png" alt="logo"></a></li>
        <div class="navbar">
            <li class="upload-button"><a href="/car_upload_page">Upload my vehicle</a></li>
            <li><a href="#">Log-In</a></li>
        </div>
    </nav>

    <!--Payment Info-->
    <div class="container">
        <div class="payment-section">
            <h2>Payment Information</h2>
            <div class="payment-icons">
                <img src="../public/img/visa.png" alt="Visa">
                <img src="../public/img/mastercard.png" alt="MasterCard">
                <img src="../public/img/paypal.png" alt="PayPal">
                <img src="../public/img/discover.png" alt="Discover">
            </div>
            <form name="paymentForm" onsubmit="return validateForm()" method="POST" action="/pay_process">
                <div class="form-group">
                    <label for="name">Your Name on Card</label>
                    <input type="text" id="name" name="name" placeholder="Your name">
                </div>
                <div class="form-group">
                    <label for="card-number">Card Number</label>
                    <input type="text" id="card-number" name="card-number" placeholder="XXXX - XXXX - XXXX - XXXX">
                </div>
                <div class="form-group-inline">
                    <div class="form-group">
                        <label for="expiration-date">Expiration Date</label>
                        <input type="text" id="expiration-date" name="expiration-date" placeholder="MM / YYYY">
                    </div>
                    <div class="form-group">
                        <label for="cvv">CVV</label>
                        <input type="text" id="cvv" name="cvv" placeholder="123">
                    </div>
                </div>
                <div class="form-group-inline">
                    <div class="form-group">
                        <label for="address">Address</label>
                        <input type="text" id="address" name="address" placeholder="Street address, State">
                    </div>
                    <div class="form-group">
                        <label for="zip-code">Zip Code</label>
                        <input type="text" id="zip-code" name="zip-code" placeholder="Zip Code">
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="apple-pay-btn">Pay with <img src="../public/img/apple-pay.jpeg" alt="Apple Pay"></button>
                </div>
                <div class="form-group">
                    <button type="submit" class="confirm-btn">Confirm Payment</button>
                </div>
            </form>
            <% if (typeof errors !== 'undefined') { %>
                <ul class="error-list">
                    <% errors.forEach(function(error) { %>
                        <li><%= error %></li>
                    <% }); %>
                </ul>
            <% } %>
        </div>

        <!--Booking Info-->
        <% let array_val = -1; %>
        <% for (let i = 0; i < ListingList.length; i++) { %>
            <% if (car.car_id === ListingList[i].car_id) { %>
                <% array_val = i; %>
            <% } %>
        <% } %>
        <div class="booking-section">
            <h2>Booking Information</h2>
            <div class="booking-info">
                <h3>Tesla Model 3 2023</h3>
                <p>Bellevue, WA</p>
                <img src="../public/img/tesla.png" alt="Tesla Model 3">
                <div class="pick-up-return-container">
                    <div class="pick-up-return">
                        <label>Pick Up</label>
                        <label>Return</label>
                    </div>
                    <div class="date-info">
                        <p class="pick-up-date"><%= ListingList[array_val].date_rented.substr(5)%> 08:00am</p>
                        <p class="return-date"><%= ListingList[array_val].date_returned.substr(5)%> 04:00PM</p>
                    </div>
                </div>                     
            </div>
            <div class="payment-details">
                <h2>Payment Details</h2>
                <div class="payment-item">
                    <span class="label">Subtotal:</span>
                    <span class="value">$<%= car.car_price_per_day %> x 3</span>
                </div>
                <div class="payment-item">
                    <span class="label">Tax:</span>
                    <span class="value">$0</span>
                </div>
                <div class="payment-item total">
                    <span class="label">Total:</span>
                    <span class="value">$<%= car.car_price_per_day * 3 %></span>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
